<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" />
        <script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="htmlImporter.js"></script>
        <link rel="stylesheet" type="text/css" href="mainstyle.css">
        <title>The Okay-est Coder: Archive</title>
        <script>
            // Initialize Firebase
            var config = {
            apiKey: "AIzaSyButp2-SFrYWWGZEZORCtE5K12WATgyPvc",
            authDomain: "okayestcoder.firebaseapp.com",
            databaseURL: "https://okayestcoder.firebaseio.com",
            projectId: "okayestcoder",
            storageBucket: "okayestcoder.appspot.com",
            messagingSenderId: "935764653668"
            };
            firebase.initializeApp(config);
            var database = firebase.database();
            var dataDump = database.ref('posts').orderByChild('index');
            // Generate list of post titles
            var string_of_posts = '<div class="post"><div class="postContentFull"><div class="addPostForm"><h1>Archive</h1><ul>';
            dataDump.on('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var childData = childSnapshot.val();
                    var postNum = childData['index'];
                    string_of_posts += '<h3><li><a id="titleLink" href="#" onclick="displayPost(' + postNum + ');return false;">' + childData['title'] + '</a></li></h3>';
                    // Display all tags of a post
                    string_of_posts +=  '<h5><strong>Tags </strong>';
                    for(var i = 0; i < childData['tags'].length; i++) {
                        string_of_posts += '<mark>&nbsp;' + childData['tags'][i] + '&nbsp;</mark>&nbsp;&nbsp;';
                    }
                    string_of_posts += '</h5>';
                });
                string_of_posts += '</ul><br /></div>';
                // Map HTML to #main div content
                var list_of_posts = string_of_posts;
                $('#main').html(list_of_posts);
            });
        </script>
    </head>
    <body>
      <noscript>
        <div class="noJavascript">
            This website requires Javascript support!
        </div>
      </noscript>
        <script>HTMLImporter.import("menu.html");</script>
        <div id="main">
        <!-- Archive list will go here; populated by javascript above -->
        </div>

        <script>

            function displayPost(postNum) {
                // Display Selected Post when displayPost() is called
                // Links to index.html and adds link parameter of post title
                var database = firebase.database();
                var post_string = "";
                var dataDump = database.ref('posts').orderByChild('index');
                var postTitle ="";
                dataDump.on('value', function(snapshot) {
                    snapshot.forEach(function(childSnapshot) {
                        var childData = childSnapshot.val();
                        if (childData['index'] == postNum) {
                            postTitle = childData['title'];
                            return true;
                        }
                    });
                });
                var newUrl = "index.html?post=" + postTitle;
                window.location.replace("" + newUrl );
            }
        </script>
    </body>
</html>
